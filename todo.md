# Learning Adventure - TODO

## 完了済み機能

### Phase 1-3: コア機能
- [x] データベーススキーマ設計(17テーブル)
- [x] バックエンドAPI実装(tRPC、36関数)
- [x] 認証システム(ロールベース)
- [x] 生徒ダッシュボード
- [x] 問題回答システム(500問)
- [x] レベル・XP・コインシステム

### Phase 4-5: ゲーミフィケーション
- [x] ログインボーナスシステム
- [x] ガチャシステム(100アイテム、4段階レアリティ)
- [x] 実績システム(20実績)
- [x] ストーリーシステム(10章、30宝物)
- [x] 学習クイズ統合(32問)

### Phase 6-7: 追加機能
- [x] 講師ダッシュボード
- [x] 課題作成フォーム
- [x] 問題作成フォーム
- [x] 保護者ダッシュボード
- [x] ChatGPT統合(キャラクター会話)
- [x] 10種類の動物キャラクター画像統合

### UI/UX改善
- [x] モバイルUI最適化(iPhone/iPad対応)
- [x] タッチ操作対応数字パッド
- [x] レベルアップアニメーション
- [x] ひらがな中心の生徒向けUI
- [x] 大人向け保護者画面デザイン

### システム整理(2025-10-29完了)
- [x] 不要ファイルの削除(ComponentShowcase.tsx)
- [x] ドキュメント整理(docs/ディレクトリ作成)
- [x] システム分析レポート作成
- [x] README更新

---

## 次のプロセス

### フェーズ1: 機能完成度向上(優先度: 高)

#### 1. 保護者-子供関係システム実装
- [ ] parent_childrenテーブル追加
- [ ] 保護者ダッシュボードの実データ対応
- [ ] 複数子供の管理機能
- [ ] 子供追加・削除機能

#### 2. キャラクター機能拡張
- [ ] キャラクター複数所持機能
- [ ] キャラクター切り替えUI
- [ ] ガチャアイテムでカスタマイズ
- [ ] キャラクター育成の視覚化
- [ ] キャラクター着せ替えプレビュー機能

#### 3. デイリーミッション実装
- [ ] ミッションテーブル追加
- [ ] 日次リセット機能
- [ ] ミッション達成UI
- [ ] 報酬システム統合

---

### フェーズ2: UI/UX改善(優先度: 中)

#### 1. アニメーション強化
- [ ] Framer Motion導入
- [ ] ページ遷移アニメーション
- [ ] マイクロインタラクション追加
- [ ] キャラクターアニメーション

#### 2. 音響効果追加
- [ ] BGM実装(5-10曲)
- [ ] 効果音追加(ボタンクリック、正解/不正解等)
- [ ] 音量調整機能
- [ ] BGM/効果音のオン/オフ切り替え

#### 3. 画像最適化
- [ ] WebP形式への変換(20MB→6-8MB)
- [ ] 遅延読み込み実装
- [ ] プログレッシブ画像読み込み
- [ ] 画像圧縮最適化

---

### フェーズ3: コード品質向上(優先度: 中)

#### 1. ルーター分割
- [ ] server/routers/student.ts
- [ ] server/routers/teacher.ts
- [ ] server/routers/parent.ts
- [ ] server/routers/story.ts
- [ ] server/routers/gacha.ts
- [ ] server/routers/achievement.ts

#### 2. テストコード追加
- [ ] ユニットテスト(Vitest)
- [ ] E2Eテスト(Playwright)
- [ ] カバレッジ目標: 70%以上
- [ ] CI/CD統合

#### 3. ドキュメント整備
- [ ] API仕様書
- [ ] コンポーネントカタログ
- [ ] 開発者ガイド
- [ ] デプロイガイド

---

### フェーズ4: 高度な機能追加(優先度: 低)

#### 1. AI機能強化
- [ ] AI画像生成統合(170アセット)
- [ ] 音声合成(TTS)機能
- [ ] 学習パターン分析
- [ ] 個別化学習推奨

#### 2. ソーシャル機能
- [ ] 友達システム
- [ ] ランキング機能
- [ ] 実績共有
- [ ] 協力プレイ機能

#### 3. 学習コンテンツ拡充
- [ ] 国語問題追加
- [ ] 英語学習コンテンツ
- [ ] 科学・理科コンテンツ
- [ ] 音楽・図工コンテンツ

---

## 既知のバグ

### 軽微
- [ ] アイテムの画像が一部重複している

### 要調査
- なし(現時点で重大なバグは検出されていません)

---

## 技術的負債

### 軽微
- [ ] server/routers.ts が694行(将来的に分割推奨)
- [ ] 一部のコンポーネントが大きい(StudentDashboard.tsx等)
- [ ] 画像最適化が未実施(WebP変換等)

### 重大な問題なし

---

## 即座に実施すべき項目(優先度順)

1. **保護者-子供関係システム実装** (最優先)
   - 保護者ダッシュボードが現在デモデータ使用
   - 実用化に必須

2. **キャラクター複数所持機能** (高優先度)
   - ユーザー体験向上
   - ガチャシステムとの連携

3. **デイリーミッション実装** (高優先度)
   - 継続的な学習動機付け
   - リテンション向上

4. **音響効果追加** (中優先度)
   - 5歳児向けの没入感向上
   - BGM 3-5曲、効果音10種類

5. **画像最適化** (中優先度)
   - パフォーマンス改善
   - 読み込み速度向上

---

## 長期目標(1-3ヶ月)

- AI生成アセット統合(170画像、25音楽トラック)
- ソーシャル機能追加
- 学習コンテンツ拡充(国語・英語)
- 実際の5歳児ユーザーテスト
- 保育園・幼稚園との連携機能

---

**最終更新:** 2025-10-29  
**バージョン:** c99761f2  
**次回レビュー:** 2025-11-05


---

## 新規バグ報告(2025-10-29)

### 重大なバグ
- [x] **問題チャレンジ**: 2問目以降で「こたえる!」ボタンが機能せず次の問題に進めない → UI調整で解決
- [x] **ストーリークイズ**: 回答送信ボタンがなく、クイズを完了できない → UI調整で解決
- [x] **ロール切り替え**: 管理者画面から他ロールに切り替えると管理者画面に戻れない → RoleSwitcher改善で解決

### 軽微なバグ
- [ ] **講師画面**: キャンセルボタンの挙動が不安定(環境依存の可能性)
- [x] **問題画面UI**: 「こたえる!」ボタンがスクロールしないと見えない → レイアウト最適化で解決

---

## 新規機能要望(2025-10-29)

### 認証・権限管理
- [x] **管理者画面の実装**: Home.tsxに管理者ダッシュボード追加
- [x] **ロールベース権限制御**: 管理者のみ講師・保護者に切り替え可能
- [x] **管理者画面への戻りボタン**: RoleSwitcherに追加
- [ ] **初回ログイン時のロール選択**: OAuth認証後のフロー(サーバー側実装が必要)

### OpenAI使用状況
- [x] **openaiUsageLogsテーブル追加**: トークン数、コスト、目的を記録
- [x] **使用ログ記録関数**: logOpenAIUsage, getOpenAIUsageSummary
- [ ] **管理者画面に表示**: トークン数・コストサマリーコンポーネント
- [ ] **ChatGPT API呼び出し時にログ記録**: CharacterChat.tsxで実装

### 難易度調整
- [ ] **動的難易度システム**: 生徒のレベルに応じた問題選択
- [ ] **正答率ベースの調整**: 正答率70-80%を目標に自動調整
- [ ] **難易度分析**: 問題ごとの正答率データ収集

### 保護者画面改善
- [x] **保護者-子供関係テーブル**: parentChildrenテーブル追加
- [x] **実データ連携**: ParentDashboard.tsxを実データ対応に変更
- [x] **保護者API実装**: getMyChildren, addChild, removeChild, getChildProgress
- [ ] **複数子供管理UI**: 子供選択ドロップダウン
- [ ] **初期データ投入**: シードスクリプトで親子関係登録

### デイリーミッション
- [x] **dailyMissionsテーブル追加**: ミッションマスターデータ
- [x] **studentDailyProgressテーブル追加**: 生徒の進捗管理
- [x] **デイリーミッションAPI**: getAllDailyMissions, getStudentDailyProgress, updateDailyMissionProgress
- [ ] **デイリーミッションUI**: 生徒ダッシュボードに表示
- [ ] **自動進捗更新**: 問題解答時にミッション進捗を更新
- [ ] **初期データ投入**: シードスクリプトでミッション登録

---

## 完了した主要機能(2025-10-29)

1. [x] **問題チャレンジの2問目バグ修正** - UI調整で解決
2. [x] **ストーリークイズの送信ボタン追加** - レイアウト最適化
3. [x] **ロール切り替えの権限制御改善** - RoleSwitcher改善、管理者ダッシュボード追加
4. [x] **問題画面UIの調整** - ボタンが常に表示されるように修正
5. [x] **保護者-子供関係システム実装** - parentChildrenテーブル、API実装完了
6. [x] **OpenAI使用ログシステム** - openaiUsageLogsテーブル、記録関数実装
7. [x] **デイリーミッションシステム** - dailyMissionsテーブル、API実装完了

## 次の実装優先順位

1. **デイリーミッションUI** - 生徒ダッシュボードに表示
2. **管理者画面にOpenAI使用状況表示** - トークン・コストサマリー
3. **動的難易度調整** - 生徒のレベルに応じた問題選択
4. **初期データ投入** - シードスクリプトでミッション・親子関係登録
5. **UI/UX改善** - アニメーション、音響効果


---

## 新規バグ・機能要望(2025-10-29 Phase 2)

### バグ修正
- [x] **管理者→生徒管理エラー**: Home.tsxでswitchRole APIを呼び出すように修正
- [x] **ログインボーナス未反映**: 機能は正常、lastLoginDateが今日の場合は表示されない(正常動作)

### 新機能
- [x] **OpenAI利用状況表示**: OpenAIUsageStatsコンポーネント、adminルーター追加
- [x] **デイリーミッション表示**: DailyMissionsコンポーネント、StudentDashboardに追加
- [ ] **新規ログイン時のロール選択**: student/parent選択画面(将来実装)
- [ ] **テストユーザー設定**: 生徒480030、保護者540011、講師540022(シードスクリプト)

### テスト項目
- [ ] **システム全体の機能テスト**: 全画面・全機能の動作確認
- [ ] **ロール切り替えテスト**: 管理者↔生徒↔講師↔保護者
- [ ] **保護者-子供関係テスト**: 親子関係の表示・管理
- [ ] **デイリーミッションテスト**: 進捗更新・報酬付与


---

## 新規バグ・機能要望(2025-10-29 Phase 3)

### バグ修正
- [ ] **ログインボーナステキスト不一致**: テキストとコメントが一致していない
- [ ] **storyChapters重複タイトル**: 同じタイトルのチャプターが存在

### データ整備
- [ ] **テストユーザー設定**: 生徒480030、保護者540011、講師540022の関係設定
- [ ] **parentChildrenデータ登録**: 540011(保護者) - 480030(生徒)の親子関係
- [ ] **講師-生徒関係**: 540022(講師) - 480030(生徒)の担当関係

### 機能改善
- [x] **管理者のロール切り替え不要化**: Home.tsx修正、直接各画面にアクセス可能
- [x] **デイリーミッション機能の具体的実装**: テーブル、API、UIコンポーネント完成
- [ ] **デイリーミッションマスターデータ登録**: SQLで直接登録(カラム名確認待ち)
- [ ] **問題解答時のミッション進捗更新**: ProblemPlay.tsxに実装
